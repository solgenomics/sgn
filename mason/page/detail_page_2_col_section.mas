<%args>
$trial_id => undef
$trial_name => undef
$stock_id => undef
$stock_uniquename => undef
$col1_width_class => "col-sm-1"
$col2_width_class => "col-sm-11"
$icon_class => "glyphicon glyphicon-th"
$info_section_collapsible => 1
$info_section_collapsed => 1
$info_section_id => "2col_id"
$info_section_title => "A title"
$info_section_subtitle => "A subtitle"
$buttons_html => undef

#Specific to trial detail page
$has_plant_entries => undef
$has_subplot_entries => undef
$has_tissue_sample_entries => undef
$has_expression_atlas => undef
$expression_atlas_url => undef
$site_project_name => undef
$sgn_session_id => undef
$user_name => undef
$main_production_site_url => undef
$trial_phenotype_files => undef
$hidap_enabled => undef
$location_name => undef
$breeding_program_name => undef
$year => undef
$trial_type => undef
$design_name => undef
$planting_date => undef
$harvest_date => undef
$trial_description => undef
$folder_name => undef
$folder_id => undef
$plot_width => undef
$plot_length => undef
$field_size => undef
$field_trial_is_planned_to_be_genotyped => undef
$field_trial_is_planned_to_cross => undef
$identifier_prefix => undef

#Specific to stock detail page
$type_name => undef
$stockref => {}
$stockprops => undef
$edit_privs => undef
$editable_stock_props => undef
$editor_link => undef
$source_dbs => {}
$locus_add_uri => undef
$new_locus_link => undef
$allele_div => undef
$is_owner => undef
$map_html => undef
$direct_genotypes => {}
$has_pedigree => undef
$image_ids => undef
$related_image_ids => undef
$dbh => undef
$trait_ontology_db_name => undef
$pubs => undef
$cvterm_add_uri => undef
$referer => undef
</%args>

<div class="row">
    <div class="col-sm-12">
        <div class="well">
            <div class="row">
                <div class="<% $col1_width_class %>">
                    <span style="font-size:3.5em;" class="<% $icon_class %>"></span>
                </div>
                <div class="<% $col2_width_class %>">

                    <&| /page/info_section.mas, id => $info_section_id, title => $info_section_title, collapsible=>$info_section_collapsible, collapsed => $info_section_collapsed, subtitle=> $info_section_subtitle &>

% if ($buttons_html){
                        <div class="panel panel-default">
                            <div class="panel-body">
                                <% $buttons_html %>
                            </div>
                        </div>
% }

                        <div class="panel panel-default">
                            <div class="panel-body">

% if ($info_section_id eq 'pheno_heatmap'){
                                <& /breeders_toolbox/trial/phenotype_heatmap.mas, trial_id => $trial_id &>
% }
% if ($info_section_id eq 'trial_design_section'){
                                <& /breeders_toolbox/trial/design_section.mas, trial_id => $trial_id, trial_name => $trial_name, has_subplot_entries => $has_subplot_entries, has_plant_entries => $has_plant_entries, has_tissue_sample_entries => $has_tissue_sample_entries, design_name => $design_name &>
% }
% if ($info_section_id eq 'trial_detail_traits_assayed'){

% if ($has_expression_atlas) {
                                <& /breeders_toolbox/trial/export_trial_to_expression_atlas.mas, trial_id => $trial_id, trial_name=>$trial_name, expression_atlas_url=>$expression_atlas_url, site_project_name=>$site_project_name, sgn_session_id=>$sgn_session_id, user_name=>$user_name, main_production_site_url=>$main_production_site_url &>
% }

                                <& /breeders_toolbox/trial/phenotype_summary.mas, trial_id => $trial_id &>

% }
% if ($info_section_id eq 'compute_derived_traits'){
                                <& /breeders_toolbox/trial/derived_trait.mas, trial_id => $trial_id &>
% }
% if ($info_section_id eq 'trial_upload_files'){
                                <& /breeders_toolbox/trial/files_section.mas, trial_id => $trial_id, trial_phenotype_files => $trial_phenotype_files &>
% }
% if ($info_section_id eq 'trial_analysis_tools'){
                                <!-- Phenotypic correlation analysis -->
                                <& /solgs/population/correlation.mas,
                                    trial_id => $trial_id
                                &>

                                <& /anova.mas,
                                    trial_id => $trial_id
                                &>

                                <!-- Population structure analysis PCA -->
                                <& /solgs/model/pca.mas,
                                    trial_id => $trial_id
                                &>

% if ($hidap_enabled) {
                                <& /hidap/hidap_trial_link.mas, trial_id => $trial_id &>
% }
% }
% if ($info_section_id eq 'trial_weather_data'){
                                <& /breeders_toolbox/trial/weather.mas, location => $location_name &>
% }
% if ($info_section_id eq 'trial_jbrowse_data'){
                                <& /breeders_toolbox/trial/jbrowse_instance.mas, trial_id => $trial_id &>
%}
% if ($info_section_id eq 'trial_linkage_section'){
                                <&| /page/info_section.mas, title => 'Field Trial to Field Trial Linkage', id => 'field_trial_from_field_trial_section', collapsible => 1, collapsed => 1 &>
                                    <& /breeders_toolbox/trial/field_trial_from_field_trial_linkage.mas, trial_id => $trial_id &>
                                </&>
                                <&| /page/info_section.mas, title => 'Field Trial to Genotyping Trial Linkage', id => 'genotyping_trial_from_field_trial_section', collapsible => 1, collapsed => 1 &>
                                    <& /breeders_toolbox/trial/genotyping_trial_from_field_trial_linkage.mas, trial_id => $trial_id, trial_type => 'field_trial' &>
                                </&>
                                <&| /page/info_section.mas, title => 'Field Trial to Crossing Trial Linkage', id => 'crossing_trial_from_field_trial_section', collapsible => 1, collapsed => 1 &>
                                    <& /breeders_toolbox/trial/crossing_trial_from_field_trial_linkage.mas, trial_id => $trial_id, trial_type => 'field_trial' &>
                                </&>
%}
% if ($info_section_id eq 'trial_deletion_section'){
                                <&| /page/info_section.mas, title=>'Delete trial data', subtitle=>'<font color="red" role="">Deletion cannot be undone</font>', collapsed=>1, collapsible=>1 &>
                                    <& /breeders_toolbox/trial/trial_deletion.mas, trial_id => $trial_id  &>
                                </&>
%}
% if ($info_section_id eq 'trial_data_agreement_section'){
                                <& /breeders_toolbox/data_agreement.mas, trial_id => $trial_id &>
% }

% if ($info_section_id eq 'stock_additional_info_section'){
                                <& /stock/additional_info_section.mas, stock_id => $stock_id, type_name => $type_name, stockprops => $stockprops, edit_privs => $edit_privs, editable_stock_props => $editable_stock_props, editor_link => $editor_link, source_dbs => $source_dbs, locus_add_uri => $locus_add_uri, allele_div => $allele_div, is_owner => $is_owner &>
% }
% if ($info_section_id eq 'stock_trials_section'){
                                <& /stock/trials.mas, stock_id => $stock_id &>
% }
% if ($info_section_id eq 'stock_traits_section'){
                                <& /stock/traits.mas, stock_id => $stock_id &>
% }
% if ($info_section_id eq 'stock_genotypes_section'){

% print $map_html;
% foreach my $project (keys %$direct_genotypes) {
%     my $genotypes = $direct_genotypes->{$project} ;
                                <&| /page/info_section.mas, title=>"Experiment: $project", is_subsection => 1, collapsible => 1 &>
%     foreach my $genotype (@$genotypes) {
%                                   print $genotype->description . "\n";
%     }
                                </&>
% }

%}
% if ($info_section_id eq 'stock_pedigree_section'){
                                <&| /page/info_section.mas, title=>"Pedigree and Descendants" , collapsible=> 1, collapsed=>0 &>
                                    <& /pedigree/stock_pedigree.mas, stock_id => $stock_id, has_pedigree => $has_pedigree &>
                                </&>

                                <& /pedigree/stock_pedigree_string.mas, stock_id => $stock_id &>
% }
% if ($info_section_id eq 'stock_related_stock_section'){
                                <& /stock/related_stock.mas, stock_id => $stock_id, stock_uniquename => $stock_uniquename, stock_type => $type_name &>
% }
% if ($info_section_id eq 'stock_images_section'){
                                <&| /page/info_section.mas, title=>"Images of This Stock(" .  scalar(@$image_ids)  . ")", collapsible=>1, collapsed=>0 &>
                                    <& /image/print_images.mas , images=>$image_ids , dbh=>$dbh &>
                                </&>

                                <&| /page/info_section.mas, title=>"Images of Related Stock(s) (" .  scalar(@$related_image_ids)  . ")", collapsible=>1, collapsed=>0 &>
                                    <& /image/print_images.mas , images=>$related_image_ids , dbh=>$dbh &>
                                </&>
% }
% if ($info_section_id eq 'stock_literature_annotation_section'){
                                <&| /page/info_section.mas, title=>"Literature annotation (".scalar( @$pubs ).")" , id=>"publications" , collapsible=>1, collapsed=>1 &>


% foreach my $publication ( @$pubs  ) {
  <& /chado/publication.mas, pub=>$publication &>
    <br >
% }

                                </&>

                                <&| /page/info_section.mas, id   => 'stock_ontology', title=>"Ontology annotation (" . $stockref->{ontology_count} . ")" &>
                                    <& /ontology/associate_ontology.mas,
                                    trait_db_name => $trait_ontology_db_name,
                                    object_id     => $stock_id ,
                                    object_name   => "stock",
                                    cvterm_add_uri=> $cvterm_add_uri,
                                    ontology_url  => "/stock/$stock_id/ontologies/",
                                    reference_uri => "/stock/$stock_id/references/",
                                    evidence_with_uri => "/stock/$stock_id/evidences/",
                                    show_form     => $is_owner  &>
                                </&>
% }
% if ($info_section_id eq 'stock_jbrowse_section'){
                                <p id="jbrowse_check">[loading...]</p>
% }
% if ($info_section_id eq 'stock_comments_section'){
                                <& /page/comments.mas, object_type=>'stock', object_id=>$stock_id, referer=>$referer &>
% }


% if ($info_section_id eq 'manage_tissue_samples_field_trials'){
                                <& /breeders_toolbox/tissue_samples/field_trials_with_tissue_samples.mas &>
% }
% if ($info_section_id eq 'manage_tissue_samples_genotyping_trials'){
                                <& /breeders_toolbox/tissue_samples/genotyping_trials.mas &>
% }

% if ($info_section_id eq 'trial_details'){
                                <div class="row">
                                    <div class="col-sm-8">

                                        <table class="table table-hover table-bordered" >

                                            <tr>
                                                <td><b>Trial Name</b></td>
                                                <td>
                                                    <div id="trial_name">
% if ($trial_name) {
%   print "$trial_name";
% } else {
%   print "<span class='text-danger'>[No Trial Name]</span>";
% }
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><b>Breeding Program </b></td>
                                                <td>
                                                    <span id="breeding_program">
% if ($breeding_program_name) {
%  print "$breeding_program_name";
% }
% else {
%  print "<span class='text-danger'>[No Breeding Program]</span>";
% }
                                                    </span>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><b>Trial Location</b></td>
                                                <td>
                                                    <div id="trial_location">
% if ($location_name) {
%  print "$location_name";
% } else {
%  print "<span class='text-danger'>[No Location]</span>";
% }
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><b>Year</b></td>
                                                <td>
                                                    <div id="trial_year">
% if ($year) {
%  print "$year";
% } else {
%  print "<span class='text-danger'>[No Year]</span>";
% }
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><b>Trial Type</b></td>
                                                <td>
                                                    <div id="trial_type">
% if ($trial_type) {
%  print "$trial_type";
% } else {
% print "<span class='text-danger'>[Type not set]</span>";
% }
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><b>Planting Date</b></td>
                                                <td>
                                                    <div id="planting_date">
% if ($planting_date) {
<a href="/breeders/trial/<% $trial_id %>?currentDate=<% $planting_date %>" ><% $planting_date %></a>
% } else {
%  print "<span class='text-danger'>[No Planting Date]</span>";
% }
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><b>Harvest Date</b></td>
                                                <td>
                                                    <div id="harvest_date">
% if ($harvest_date) {
<a href="/breeders/trial/<% $trial_id %>?currentDate=<% $harvest_date %>" ><% $harvest_date %></a>
% } else {
%  print "<span class='text-danger'>[No Harvest Date]</span>";
% }
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr><td><b>Description</b></td>
                                                <td>
                                                    <div id="trial_description">
% if ($trial_description) {
%  print "$trial_description";
% } else {
%  print "<span class='text-danger'>[No Description]</span>";
% }
                                                    </div>
                                                </td>
                                            </tr>

                                            <tr>
                                                <td><b>Folder</b></td>
                                                <td>
                                                    <span id="trial_folder_div"><a href="/folder/<% $folder_id %>"><% $folder_name %></a></span>
                                                    <br/><br/>
                                                    <button class="btn btn-sm btn-default" style="margin:3px" id="new_folder_dialog_link">New Folder</button> <button class="btn btn-sm btn-default" style="margin:3px" id="open_folder_dialog_link">Change Folder</button>
                                                </td>
                                            </tr>

                                        </table>

                                    </div>
                                    <div class="col-sm-4">
                                        <div class="well well-sm">
                                            <& /util/barcode.mas, identifier => "$identifier_prefix"."$trial_id", trial_id=> "$trial_id", trial_name=> "$trial_name", format=>"trial_qrcode"  &>
                                        </div>

                                        <table class="table table-hover table-bordered">
                                            <tr><td><b>Plot Width (m)</b></td>
                                                <td>
                                                    <div id="trial_description">
% if ($plot_width) {
%  print "$plot_width";
% } else {
%  print "<span class='text-default'>[No Plot Width]</span>";
% }
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr><td><b>Plot Length (m)</b></td>
                                                <td>
                                                    <div id="trial_description">
% if ($plot_length) {
%  print "$plot_length";
% } else {
%  print "<span class='text-default'>[No Plot Length]</span>";
% }
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr><td><b>Field Size (ha)</b></td>
                                                <td>
                                                    <div id="trial_description">
% if ($field_size) {
%  print "$field_size";
% } else {
%  print "<span class='text-default'>[No Field Size]</span>";
% }
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr><td><b>Trial Will Be Genotyped</b></td>
                                                <td>
                                                    <div id="trial_description">
% if ($field_trial_is_planned_to_be_genotyped) {
%  print "$field_trial_is_planned_to_be_genotyped";
% } else {
%  print "no";
% }
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr><td><b>Trial Will Be In Crosses</b></td>
                                                <td>
                                                    <div id="trial_description">
% if ($field_trial_is_planned_to_cross) {
%  print "$field_trial_is_planned_to_cross";
% } else {
%  print "no";
% }
                                                    </div>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
% }
% if ($info_section_id eq 'stocks_search_graphical_filtering'){
                                <& /search/stocks_graphicalfiltering.mas &>
% }

                            </div>
                        </div>
                    </&>

                </div>
            </div>
        </div>
    </div>
</div>
