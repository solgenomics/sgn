
<%args>
$trial_id => undef
$trial_name => undef
$download_type
</%args>

<div class="modal fade" id="create_fieldbook_dialog_<% $download_type %>" name="create_fieldbook_dialog_<% $download_type %>" tabindex="-1" role="dialog" aria-labelledby="createFieldbookDialog_<% $download_type %>">
  <div class="modal-dialog modal-xl" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="createFieldbookDialog_<% $download_type %>">Download <% $download_type %> for <% $trial_name %></h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
            <form class="form-horizontal" role="form" method="post" >
                <div class="well">
                    <div class="form-group">
                        <label class="col-sm-3 control-label">Trial: </label>
                        <div class="col-sm-9" >
                            <div id="select_trial_for_create_fieldbook_<% $download_type %>">
% if ($trial_id) {
                                <input type="text" class="form-control" value="<% $trial_name %>" disabled/>
                                <input type="hidden" id="html_select_trial_for_create_fieldbook_<% $download_type %>" name="html_select_trial_for_create_fieldbook_<% $download_type %>" value="<% $trial_id %>" />
% } else {
                    [Loading...]
% }
                            </div>
                        </div>
                    </div>
                    <div id="create_fieldbook_format_div_<% $download_type %>" style="display:none">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Format: </label>
                            <div class="col-sm-9" >
                                <select class="form-control" id="create_fieldbook_format_<% $download_type %>">
                                    <option value="csv">CSV</option>
                                    <option value="xls">Excel (xls)</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div id="management_factore">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Management Factor: </label>
                            <div class="col-sm-9" >
                                <div id="create_fieldbook_treatment_<% $download_type %>">
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-3 control-label">Data Level: </label>
                        <div class="col-sm-9" >
                            <select class="form-control" id="create_fieldbook_data_level_<% $download_type %>">
                                <option value="plots">Plots</option>
                                <option value="plants">Plants</option>
                                <option value="subplots">Subplots</option>
                                <option value="field_trial_tissue_samples">Tissue Samples</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div id="selected_columns_well">
                    <div class="well">
                        <center><h4>Choose the columns you want to include (Or simply use defaults and click "Submit")</h4></center>
                        <hr>
                        <div class="row">
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Included Columns: </label>
                                    <div class="col-sm-9" >
                                        <div id="create_fieldbook_included_columns_<% $download_type %>">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-sm-6">
                                <div class="form-group">
                                    <label class="col-sm-3 control-label">Not Included Columns: </label>
                                    <div class="col-sm-9" >
                                        <div id="create_fieldbook_not_included_columns_<% $download_type %>">
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="accession_average_performance">
                    <div class="well">
                        <div class="form-group">
                            <label class="col-sm-3 control-label">Optional: Include columns for average performance of accessions (for all measurements in database) for list of traits: </label>
                            <div class="col-sm-9" >
                                <div id="create_fieldbook_with_trait_list_<% $download_type %>">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </form><br/>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" name="create_fieldbook_cancel_button_<% $download_type %>" id="create_fieldbook_cancel_button_<% $download_type %>" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" name="create_fieldbook_ok_button_<% $download_type %>" id="create_fieldbook_ok_button_<% $download_type %>" title="Submit">Submit</button>
      </div>
    </div>
  </div>
</div>

<div class="modal fade" id="tablet_field_layout_saved_dialog_message_<% $download_type %>" name="tablet_field_layout_saved_dialog_message_<% $download_type %>" tabindex="-1" role="dialog" aria-labelledby="createFieldbookSavedDialog_<% $download_type %>">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="createFieldbookSavedDialog_<% $download_type %>"><% $download_type %> for <% $trial_name %> Created</h4>
      </div>
      <div class="modal-body">
        <div class="container-fluid">
            <p>
              <span class="ui-icon ui-icon-circle-check" style="float: left; margin: 0 7px 50px 0;"></span>
              The field book layout file was saved successfully
            </p>
            <div id="tablet_field_layout_get_file_<% $download_type %>"></div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default" name="create_fieldbook_cancel_button_<% $download_type %>" id="create_fieldbook_cancel_button_<% $download_type %>" data-dismiss="modal">Close</button>
      </div>
    </div>
  </div>
</div>

<script>

var selected_columns_<% $download_type %> = {};
var not_selected_columns_<% $download_type %> = {};
var has_plants_<% $download_type %> = 0;
var has_subplots_<% $download_type %> = 0;
var has_tissue_samples_<% $download_type %> = 0;

jQuery(document).ready(function() {

    if(jQuery("#html_select_trial_for_create_fieldbook_<% $download_type %>").length == 0) {
        get_select_box('trials', 'select_trial_for_create_fieldbook_<% $download_type %>', { 'name' : 'html_select_trial_for_create_fieldbook_<% $download_type %>', 'id' : 'html_select_trial_for_create_fieldbook_<% $download_type %>' });
    }

    jQuery(document).on('change', '#html_select_trial_for_create_fieldbook_<% $download_type %>', function() {
        show_fieldbook_treatments_<% $download_type %>();
    });

    jQuery("#trial_download_layout_button").click( function () {
        show_available_columns_TrialLayout('plots');
        var lo = new CXGN.List();
        jQuery('#create_fieldbook_with_trait_list_TrialLayout').html(lo.listSelect('create_fieldbook_with_trait_list_select_TrialLayout', [ 'traits' ], 'select'));
        jQuery('#accession_average_performance').css("display", "inline-block");
        jQuery('#selected_columns_well').css("display", "inline-block");
        jQuery('#management_factore').css("display", "inline-block");
        jQuery('#create_fieldbook_dialog_TrialLayout').modal('show');
        show_fieldbook_treatments_TrialLayout();
    });
    
    jQuery("#trial_fieldmap_download_layout_button").click( function () {
        jQuery('#management_factore').css("display", "none");
        jQuery("#create_fieldbook_format_TrialFieldMapLayout option[value='xls']").prop('selected', true);
        jQuery("#create_fieldbook_format_TrialFieldMapLayout").prop('disabled', 'disabled');
        jQuery("#create_fieldbook_data_level_TrialFieldMapLayout").prop('disabled', 'disabled');
        show_available_columns_TrialFieldMapLayout('plots');
        var lo = new CXGN.List();
        jQuery('#create_fieldbook_with_trait_list_TrialFieldMapLayout').html(lo.listSelect('create_fieldbook_with_trait_list_select_TrialFieldMapLayout', [ 'traits' ], 'select'));
        jQuery('#accession_average_performance').css("display", "none");
        jQuery('#selected_columns_well').css("display", "none");
        jQuery('#create_fieldbook_dialog_TrialFieldMapLayout').modal('show');
        show_fieldbook_treatments_TrialFieldMapLayout();
    });

    jQuery("[name='create_fieldbook_link']").click( function () {
        show_available_columns_Fieldbook('plots');
        var lo = new CXGN.List();
        jQuery('#create_fieldbook_with_trait_list_Fieldbook').html(lo.listSelect('create_fieldbook_with_trait_list_select_Fieldbook', [ 'traits' ], 'select'));
        jQuery('#create_fieldbook_dialog_Fieldbook').modal('show');
        show_fieldbook_treatments_Fieldbook();
    });
        
    jQuery('#create_fieldbook_ok_button_<% $download_type %>').on('click', function() {
        open_create_fieldbook_dialog_<% $download_type %>();
    });

    jQuery('#create_fieldbook_data_level_<% $download_type %>').on('change', function(){
        var selected_trial_id = parseInt(jQuery('#html_select_trial_for_create_fieldbook_<% $download_type %>').val());
        var level = jQuery('#create_fieldbook_data_level_<% $download_type %>').val();
        if (level == 'plots'){
            show_available_columns_<% $download_type %>('plots');
        } else {
            new jQuery.ajax({
                type: 'POST',
                url: '/ajax/breeders/trial/'+selected_trial_id+'/has_plants',
                dataType: "json",
                beforeSend: function() {
                    jQuery("#working_modal").modal("show");
                },
                success: function (response) {
                    //console.log(response);
                    jQuery("#working_modal").modal("hide");
                    if(response.has_plants == 0){
                        has_plants_<% $download_type %> = 0;
                        if (level == 'plants'){
                            alert('This trial does not have '+level);
                            show_available_columns_<% $download_type %>('plots');
                            jQuery('#create_fieldbook_data_level_<% $download_type %>').val('plots');
                        }
                    } else {
                        has_plants_<% $download_type %> = 1;
                        if (level == 'plants'){
                            show_available_columns_<% $download_type %>(level);
                        }
                    }
                },
                error: function () {
                    jQuery("#working_modal").modal("hide");
                    alert('An error occurred checking trial for plants or subplots.');
                }
            });
            new jQuery.ajax({
                type: 'POST',
                url: '/ajax/breeders/trial/'+selected_trial_id+'/has_subplots',
                dataType: "json",
                beforeSend: function() {
                    jQuery("#working_modal").modal("show");
                },
                success: function (response) {
                    //console.log(response);
                    jQuery("#working_modal").modal("hide");
                    if(response.has_subplots == 0){
                        has_subplots_<% $download_type %> = 0;
                        if (level == 'subplots'){
                            alert('This trial does not have '+level);
                            show_available_columns_<% $download_type %>('plots');
                            jQuery('#create_fieldbook_data_level_<% $download_type %>').val('plots');
                        }
                    } else {
                        has_subplots_<% $download_type %> = 1;
                        if (level == 'subplots'){
                            show_available_columns_<% $download_type %>(level);
                        }
                    }
                },
                error: function () {
                    jQuery("#working_modal").modal("hide");
                    alert('An error occurred checking trial for plants or subplots.');
                }
            });
            new jQuery.ajax({
                type: 'POST',
                url: '/ajax/breeders/trial/'+selected_trial_id+'/has_tissue_samples',
                dataType: "json",
                beforeSend: function() {
                    jQuery("#working_modal").modal("show");
                },
                success: function (response) {
                    //console.log(response);
                    jQuery("#working_modal").modal("hide");
                    if(response.has_tissue_samples == 0){
                        has_tissue_samples_<% $download_type %> = 0;
                        if (level == 'field_trial_tissue_samples'){
                            alert('This trial does not have '+level);
                            show_available_columns_<% $download_type %>('plots');
                            jQuery('#create_fieldbook_data_level_<% $download_type %>').val('plots');
                        }
                    } else {
                        has_tissue_samples_<% $download_type %> = 1;
                        if (level == 'field_trial_tissue_samples'){
                            show_available_columns_<% $download_type %>(level);
                        }
                    }
                },
                error: function () {
                    jQuery("#working_modal").modal("hide");
                    alert('An error occurred checking trial for plants or subplots.');
                }
            });
        }

    });

});

function show_available_columns_<% $download_type %>(level){
    not_selected_columns_<% $download_type %> = {'synonyms':1,'trial_name':1,'location_name':1,'year':1,'pedigree':1,'tier':1,'seedlot_name':1,'seed_transaction_operator':1,'num_seed_per_plot':1,'range_number':1, 'plot_geo_json':1};
    var not_inc_html_<% $download_type %> = '<h2><span class="label label-info">synonyms &nbsp;<a onClick="include_column_<% $download_type %>(\'synonyms\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2><h2><span class="label label-info">trial_name &nbsp;<a onClick="include_column_<% $download_type %>(\'trial_name\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2><h2><span class="label label-info">location_name &nbsp;<a onClick="include_column_<% $download_type %>(\'location_name\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2><h2><span class="label label-info">year &nbsp;<a onClick="include_column_<% $download_type %>(\'year\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2><h2><span class="label label-info">pedigree &nbsp;<a onClick="include_column_<% $download_type %>(\'pedigree\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2><h2><span class="label label-info">tier &nbsp;<a onClick="include_column_<% $download_type %>(\'tier\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2><h2><span class="label label-info">seedlot_name &nbsp;<a onClick="include_column_<% $download_type %>(\'seedlot_name\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2><h2><span class="label label-info">seed_transaction_operator &nbsp;<a onClick="include_column_<% $download_type %>(\'seed_transaction_operator\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2><h2><span class="label label-info">num_seed_per_plot &nbsp;<a onClick="include_column_<% $download_type %>(\'num_seed_per_plot\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2><h2><span class="label label-info">range_number &nbsp;<a onClick="include_column_<% $download_type %>(\'range_number\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2><h2><span class="label label-info">plot_geo_json &nbsp;<a onClick="include_column_<% $download_type %>(\'plot_geo_json\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2>';
    
    selected_columns_<% $download_type %> = {};
    var included_html_<% $download_type %> = '';
    if(level == 'plots'){
        included_html_<% $download_type %> = '<h2 id="fieldbook_columns_plot_name_<% $download_type %>"><span class="label label-primary">plot_name <span title="Unique name identifier for each plot. This is a globally unique plot name in the database. If you have barcoded your plots for phenotyping, this is what is encoded in the barcode." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_plot_id_<% $download_type %>"><span class="label label-primary">plot_id <span title="Unique database identifier for each plot. This is a globally unique id in the database." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_block_number_<% $download_type %>"><span class="label label-primary">block_number <span title="Field design parameter used to distinguish blocks in your field." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'block_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plot_number_<% $download_type %>"><span class="label label-primary">plot_number <span title="Number for the plot in your field design. Typically 1001, 1002, 2001, 2002, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_rep_number_<% $download_type %>"><span class="label label-primary">rep_number <span title="Field design parameter used to determine replicate number." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'rep_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_row_number_<% $download_type %>"><span class="label label-primary">row_number <span title="The row number that this plot is in. If you partition the field into a grid, this would be the vertical position (y coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'row_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_col_number_<% $download_type %>"><span class="label label-primary">col_number <span title="The column number that this plot is in. If you partition the field into a grid, this would be the horizontal position (x coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'col_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_accession_name_<% $download_type %>"><span class="label label-primary">accession_name <span title="The accession name which was planted in the plot." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'accession_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_is_a_control_<% $download_type %>"><span class="label label-primary">is_a_control <span title="This is either 1 or 0, meaning that the plot is a control in the experiment or not." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'is_a_control\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2>';
        selected_columns_<% $download_type %> = {'plot_name':1,'plot_id':1,'block_number':1,'plot_number':1,'rep_number':1,'row_number':1,'col_number':1,'accession_name':1,'is_a_control':1};
    }
    if(level == 'plants'){
        if (has_subplots_<% $download_type %> == 1){
            included_html_<% $download_type %> = '<h2 id="fieldbook_columns_plant_name_<% $download_type %>"><span class="label label-primary">plant_name <span title="Unique name identifier for each plant in a subplot in a plot. This is a globally unique plant name in the database. If you have barcoded your plants for phenotyping, this is what is encoded in the barcode." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_plant_id_<% $download_type %>"><span class="label label-primary">plant_id <span title="Unique database identifier for each plant in a subplot in a plot. This is a globally unique identifier in the database." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_subplot_name_<% $download_type %>"><span class="label label-primary">subplot_name <span title="Unique name identifier for each subplot in a plot. This is a globally unique subplot name in the database." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'subplot_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plot_name_<% $download_type %>"><span class="label label-primary">plot_name <span title="Unique name identifier for each plot. This is a globally unique plot name in the database." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_block_number_<% $download_type %>"><span class="label label-primary">block_number <span title="Field design parameter used to distinguish blocks in your field." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'block_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plant_number_<% $download_type %>"><span class="label label-primary">plant_number <span title="Number for the plant in your plot in the field design. Typically 1, 2, 3, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plant_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_subplot_number_<% $download_type %>"><span class="label label-primary">subplot_number <span title="Number for the subplot in your plot in the field design. Typically 1, 2, 3, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'subplot_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plot_number_<% $download_type %>"><span class="label label-primary">plot_number <span title="Number for the plot in your field design. Typically 1001, 1002, 2001, 2002, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_rep_number_<% $download_type %>"><span class="label label-primary">rep_number <span title="Field design parameter used to determine replicate number." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'rep_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_row_number_<% $download_type %>"><span class="label label-primary">row_number <span title="The row number that this plot is in. If you partition the field into a grid, this would be the vertical position (y coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'row_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_col_number_<% $download_type %>"><span class="label label-primary">col_number <span title="The column number that this plot is in. If you partition the field into a grid, this would be the horizontal position (x coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'col_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_accession_name_<% $download_type %>"><span class="label label-primary">accession_name <span title="The accession name which was planted in the plot." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'accession_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_is_a_control_<% $download_type %>"><span class="label label-primary">is_a_control <span title="This is either 1 or 0, meaning that the plot is a control in the experiment or not." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'is_a_control\')"><span title="Do not include" class="glyphicon    glyphicon-remove-circle" style="color:red"></span></a></span></h2>';
            selected_columns_<% $download_type %> = {'plant_name':1,'plant_id':1,'subplot_name':1,'plot_name':1,'block_number':1,'plant_number':1,'subplot_number':1,'plot_number':1,'rep_number':1,'row_number':1,'col_number':1,'accession_name':1,'is_a_control':1};
        } else {
            included_html_<% $download_type %> = '<h2 id="fieldbook_columns_plant_name_<% $download_type %>"><span class="label label-primary">plant_name <span title="Unique name identifier for each plant in a plot. This is a globally unique plant name in the database. If you have barcoded your plants for phenotyping, this is what is encoded in the barcode." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_plant_id_<% $download_type %>"><span class="label label-primary">plant_id <span title="Unique database identifier for each plant in a plot. This is a globally unique identifier in the database." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_plot_name_<% $download_type %>"><span class="label label-primary">plot_name <span title="Unique name identifier for each plot. This is a globally unique plot name in the database." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_block_number_<% $download_type %>"><span class="label label-primary">block_number <span title="Field design parameter used to distinguish blocks in your field." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'block_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plant_number_<% $download_type %>"><span class="label label-primary">plant_number <span title="Number for the plant in your plot in the field design. Typically 1, 2, 3, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plant_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plot_number_<% $download_type %>"><span class="label label-primary">plot_number <span title="Number for the plot in your field design. Typically 1001, 1002, 2001, 2002, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_rep_number_<% $download_type %>"><span class="label label-primary">rep_number <span title="Field design parameter used to determine replicate number." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'rep_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_row_number_<% $download_type %>"><span class="label label-primary">row_number <span title="The row number that this plot is in. If you partition the field into a grid, this would be the vertical position (y coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'row_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_col_number_<% $download_type %>"><span class="label label-primary">col_number <span title="The column number that this plot is in. If you partition the field into a grid, this would be the horizontal position (x coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'col_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_accession_name_<% $download_type %>"><span class="label label-primary">accession_name <span title="The accession name which was planted in the plot." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'accession_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_is_a_control_<% $download_type %>"><span class="label label-primary">is_a_control <span title="This is either 1 or 0, meaning that the plot is a control in the experiment or not." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'is_a_control\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2>';
            selected_columns_<% $download_type %> = {'plant_name':1,'plant_id':1,'plot_name':1,'block_number':1,'plant_number':1,'plot_number':1,'rep_number':1,'row_number':1,'col_number':1,'accession_name':1,'is_a_control':1};
        }
    }
    if(level == 'subplots'){
        included_html_<% $download_type %> = '<h2 id="fieldbook_columns_subplot_name_<% $download_type %>"><span class="label label-primary">subplot_name <span title="Unique name identifier for each subplot in a plot. This is a globally unique subplot name in the database. If you have barcoded your subplots for phenotyping, this is what is encoded in the barcode." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_subplot_id_<% $download_type %>"><span class="label label-primary">subplot_id <span title="Unique database identifier for each subplot in a plot. This is a globally unique identifier in the database." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_plot_name_<% $download_type %>"><span class="label label-primary">plot_name <span title="Unique name identifier for each plot. This is a globally unique plot name in the database." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_block_number_<% $download_type %>"><span class="label label-primary">block_number <span title="Field design parameter used to distinguish blocks in your field." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'block_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_subplot_number_<% $download_type %>"><span class="label label-primary">subplot_number <span title="Number for the subplot in your plot in the field design. Typically 1, 2, 3, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'subplot_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plot_number_<% $download_type %>"><span class="label label-primary">plot_number <span title="Number for the plot in your field design. Typically 1001, 1002, 2001, 2002, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_rep_number_<% $download_type %>"><span class="label label-primary">rep_number <span title="Field design parameter used to determine replicate number." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'rep_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_row_number_<% $download_type %>"><span class="label label-primary">row_number <span title="The row number that this plot is in. If you partition the field into a grid, this would be the vertical position (y coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'row_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_col_number_<% $download_type %>"><span class="label label-primary">col_number <span title="The column number that this plot is in. If you partition the field into a grid, this would be the horizontal position (x coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'col_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_accession_name_<% $download_type %>"><span class="label label-primary">accession_name <span title="The accession name which was planted in the plot." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'accession_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_is_a_control_<% $download_type %>"><span class="label label-primary">is_a_control <span title="This is either 1 or 0, meaning that the plot is a control in the experiment or not." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'is_a_control\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2>';
        selected_columns_<% $download_type %> = {'subplot_name':1,'subplot_id':1,'plot_name':1,'block_number':1,'subplot_number':1,'plot_number':1,'rep_number':1,'row_number':1,'col_number':1,'accession_name':1,'is_a_control':1};
    }
    if(level == 'field_trial_tissue_samples'){
        if (has_subplots_<% $download_type %> == 1){
            included_html_<% $download_type %> = '<h2 id="fieldbook_columns_tissue_sample_name_<% $download_type %>"><span class="label label-primary">tissue_sample_name <span title="Unique name identifier for each tissue_sample for a plant in a subplot in a plot. This is a globally unique tissue sample name in the database. If you have barcoded your tissue samples, this is what is encoded in the barcode." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_tissue_sample_id_<% $download_type %>"><span class="label label-primary">tissue_sample_id <span title="Unique database identifier for each tissue_sample for a plant in a subplot in a plot. This is a globally unique identifier in the database." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_plant_name_<% $download_type %>"><span class="label label-primary">plant_name <span title="Unique name identifier for each plant in a subplot in a plot. This is a globally unique plant name in the database. If you have barcoded your plants for phenotyping, this is what is encoded in the barcode." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_subplot_name_<% $download_type %>"><span class="label label-primary">subplot_name <span title="Unique name identifier for each subplot in a plot. This is a globally unique subplot name in the database." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'subplot_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plot_name_<% $download_type %>"><span class="label label-primary">plot_name <span title="Unique name identifier for each plot. This is a globally unique plot name in the database." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_block_number_<% $download_type %>"><span class="label label-primary">block_number <span title="Field design parameter used to distinguish blocks in your field." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'block_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_tissue_sample_number_<% $download_type %>"><span class="label label-primary">tissue_sample_number <span title="Number for the tissue_sample in your plot in the field design. Typically 1, 2, 3, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'tissue_sample_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plant_number_<% $download_type %>"><span class="label label-primary">plant_number <span title="Number for the plant in your plot in the field design. Typically 1, 2, 3, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plant_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_subplot_number_<% $download_type %>"><span class="label label-primary">subplot_number <span title="Number for the subplot in your plot in the field design. Typically 1, 2, 3, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'subplot_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plot_number_<% $download_type %>"><span class="label label-primary">plot_number <span title="Number for the plot in your field design. Typically 1001, 1002, 2001, 2002, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_rep_number_<% $download_type %>"><span class="label label-primary">rep_number <span title="Field design parameter used to determine replicate number." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'rep_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_row_number_<% $download_type %>"><span class="label label-primary">row_number <span title="The row number that this plot is in. If you partition the field into a grid, this would be the vertical position (y coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'row_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_col_number_<% $download_type %>"><span class="label label-primary">col_number <span title="The column number that this plot is in. If you partition the field into a grid, this would be the horizontal position (x coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'col_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_accession_name_<% $download_type %>"><span class="label label-primary">accession_name <span title="The accession name which was planted in the plot." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'accession_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_is_a_control_<% $download_type %>"><span class="label label-primary">is_a_control <span title="This is either 1 or 0, meaning that the plot is a control in the experiment or not." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'is_a_control\')"><span title="Do not include" class="glyphicon    glyphicon-remove-circle" style="color:red"></span></a></span></h2>';
            selected_columns_<% $download_type %> = {'tissue_sample_name':1,'tissue_sample_id':1,'plant_name':1,'subplot_name':1,'plot_name':1,'block_number':1,'tissue_sample_number':1,'plant_number':1,'subplot_number':1,'plot_number':1,'rep_number':1,'row_number':1,'col_number':1,'accession_name':1,'is_a_control':1};
        } else {
            included_html_<% $download_type %> = '<h2 id="fieldbook_columns_tissue_sample_name_<% $download_type %>"><span class="label label-primary">tissue_sample_name <span title="Unique name identifier for each tissue_sample for a plant in a plot. This is a globally unique tissue sample name in the database. If you have barcoded your tissue samples, this is what is encoded in the barcode." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_tissue_sample_id_<% $download_type %>"><span class="label label-primary">tissue_sample_id <span title="Unique database identifier for each tissue_sample for a plant in a plot. This is a globally unique identifier in the database." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_plant_name_<% $download_type %>"><span class="label label-primary">plant_name <span title="Unique name identifier for each plant in a plot. This is a globally unique plant name in the database. If you have barcoded your plants for phenotyping, this is what is encoded in the barcode." class="glyphicon glyphicon-info-sign"></span></span></h2><h2 id="fieldbook_columns_plot_name_<% $download_type %>"><span class="label label-primary">plot_name <span title="Unique name identifier for each plot. This is a globally unique plot name in the database." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_block_number_<% $download_type %>"><span class="label label-primary">block_number <span title="Field design parameter used to distinguish blocks in your field." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'block_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_tissue_sample_number_<% $download_type %>"><span class="label label-primary">tissue_sample_number <span title="Number for the tissue_sample in your plot in the field design. Typically 1, 2, 3, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'tissue_sample_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plant_number_<% $download_type %>"><span class="label label-primary">plant_number <span title="Number for the plant in your plot in the field design. Typically 1, 2, 3, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plant_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plot_number_<% $download_type %>"><span class="label label-primary">plot_number <span title="Number for the plot in your field design. Typically 1001, 1002, 2001, 2002, etc" class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_rep_number_<% $download_type %>"><span class="label label-primary">rep_number <span title="Field design parameter used to determine replicate number." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'rep_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_row_number_<% $download_type %>"><span class="label label-primary">row_number <span title="The row number that this plot is in. If you partition the field into a grid, this would be the vertical position (y coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'row_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_col_number_<% $download_type %>"><span class="label label-primary">col_number <span title="The column number that this plot is in. If you partition the field into a grid, this would be the horizontal position (x coordinate). Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'col_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_accession_name_<% $download_type %>"><span class="label label-primary">accession_name <span title="The accession name which was planted in the plot." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'accession_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_is_a_control_<% $download_type %>"><span class="label label-primary">is_a_control <span title="This is either 1 or 0, meaning that the plot is a control in the experiment or not." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'is_a_control\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2>';
            selected_columns_<% $download_type %> = {'tissue_sample_name':1,'tissue_sample_id':1,'plant_name':1,'plot_name':1,'block_number':1,'tissue_sample_number':1,'plant_number':1,'plot_number':1,'rep_number':1,'row_number':1,'col_number':1,'accession_name':1,'is_a_control':1};
        }
    }

    included_html_<% $download_type %> += '<h2 id="fieldbook_columns_synonyms_<% $download_type %>" style="display:none"><span class="label label-primary">synonyms <span title="Accession names can have many synonyms. Synonyms are useful for capturing locally used accession names." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'synonyms\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_trial_name_<% $download_type %>" style="display:none"><span class="label label-primary">trial_name <span title="The trial name that the plot is in will appear." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'trial_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_location_name_<% $download_type %>" style="display:none"><span class="label label-primary">location_name <span title="The location that this trial is in will appear." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'location_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_year_<% $download_type %>" style="display:none"><span class="label label-primary">year <span title="The year that this trial occured will appear." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'year\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_pedigree_<% $download_type %>" style="display:none"><span class="label label-primary">pedigree <span title="The pedigree of the accession which was planted in the plot will appear. Only shows parents." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'pedigree\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_tier_<% $download_type %>" style="display:none"><span class="label label-primary">tier <span title="A combined view of row_number/col_number. If the field is drawn as a grid, the row_number is the y coordinate and the col_number is the x coordinate." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'tier\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_seedlot_name_<% $download_type %>" style="display:none"><span class="label label-primary">seedlot_name <span title="The source seedlot_name from which the plot was planted. Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'seedlot_name\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_seed_transaction_operator_<% $download_type %>" style="display:none"><span class="label label-primary">seed_transaction_operator <span title="The operator who created the seedlot_transaction between the seedlot and the plot. The seedlot_name indicates the source from which the plot was planted. Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'seed_transaction_operator\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_num_seed_per_plot_<% $download_type %>" style="display:none"><span class="label label-primary">num_seed_per_plot <span title="The number of seeds that were taken from the seedlot and planted in this plot. The seedlot_name indicates the source from which the plot was planted. Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'num_seed_per_plot\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_range_number_<% $download_type %>" style="display:none"><span class="label label-primary">range_number <span title="The range number for the plot. This is often synonymous with col_number. Not all trials have this information saved." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'range_number\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2><h2 id="fieldbook_columns_plot_geo_json_<% $download_type %>" style="display:none"><span class="label label-primary">plot_geo_json <span title="GPS Coordinates for the plot. It will show as a GEO JSON string." class="glyphicon glyphicon-info-sign"></span>&nbsp;<a onClick="do_not_include_column_<% $download_type %>(\'plot_geo_json\')"><span title="Do not include" class="glyphicon glyphicon-remove-circle" style="color:red"></span></a></span></h2>';

    jQuery('#create_fieldbook_included_columns_<% $download_type %>').html(included_html_<% $download_type %>);
    jQuery('#create_fieldbook_not_included_columns_<% $download_type %>').html(not_inc_html_<% $download_type %>);
}

function do_not_include_column_<% $download_type %>(name){
    delete selected_columns_<% $download_type %>[name];
    not_selected_columns_<% $download_type %>[name] = 1;
    var identifier = '#fieldbook_columns_'+name+'_<% $download_type %>';
    jQuery(identifier).hide();
    display_not_selected_columns_<% $download_type %>();
    console.log(selected_columns_<% $download_type %>);
}

function display_not_selected_columns_<% $download_type %>(){
    var html_<% $download_type %> = '';
    for (var name in not_selected_columns_<% $download_type %>) {
        if (not_selected_columns_<% $download_type %>.hasOwnProperty(name)) {
            html_<% $download_type %> += '<h2><span class="label label-info">'+name+'&nbsp;<a onClick="include_column_<% $download_type %>(\''+name+'\')"><span title="Include" class="glyphicon glyphicon-ok-circle" style="color:green"></span></a></span></h2>';
        }
    }
    jQuery('#create_fieldbook_not_included_columns_<% $download_type %>').html(html_<% $download_type %>);
}

function include_column_<% $download_type %>(name){
    var identifier = '#fieldbook_columns_'+name+'_<% $download_type %>';
    jQuery(identifier).show();
    delete not_selected_columns_<% $download_type %>[name];
    selected_columns_<% $download_type %>[name] = 1;
    display_not_selected_columns_<% $download_type %>();
    console.log(selected_columns_<% $download_type %>);
}

% if ($download_type eq 'Fieldbook'){

function show_fieldbook_treatments_<% $download_type %>(){
    var selected_trial_id = parseInt(jQuery("#html_select_trial_for_create_fieldbook_<% $download_type %>").val());
    get_select_box('treatments', 'create_fieldbook_treatment_<% $download_type %>', { 'name':'html_select_treatment_create_fieldbook_<% $download_type %>', 'id':'html_select_treatment_create_fieldbook_<% $download_type %>', 'trial_id':selected_trial_id, 'empty':1 });
}

function open_create_fieldbook_dialog_<% $download_type %>() {
    new jQuery.ajax({
        type: 'POST',
        url: '/ajax/fieldbook/create',
        dataType: "json",
        data: {
            'trial_id': parseInt(jQuery('#html_select_trial_for_create_fieldbook_<% $download_type %>').val()),
            'data_level': jQuery('#create_fieldbook_data_level_<% $download_type %>').val(),
            'treatment_project_id': jQuery("#html_select_treatment_create_fieldbook_<% $download_type %>").val(),
            'selected_columns':JSON.stringify(selected_columns_<% $download_type %>),
            'trait_list':jQuery('#create_fieldbook_with_trait_list_select_<% $download_type %>_list_select').val()
        },
        beforeSend: function() {
            jQuery("#working_modal").modal("show");
        },
        success: function (response) {
            jQuery("#working_modal").modal("hide");
            if (response.error){
                alert(response.error);
            }
            else if (response.error_string) {
                alert(response.error_string);
            } else {
                jQuery('#tablet_field_layout_get_file_<% $download_type %>').html('<a href="/fieldbook/trial_download/'+response.file_id+'">'+response.file+'</a>')
                jQuery("#tablet_field_layout_saved_dialog_message_<% $download_type %>").modal("show");
                jQuery('#create_fieldbook_dialog_<% $download_type %>').modal("hide");
            }
        },
        error: function () {
            jQuery("#working_modal").modal("hide");
            alert('An error occurred creating the field book.');
            jQuery('#create_fieldbook_dialog_<% $download_type %>').modal("hide");
        }
    });
}

% } elsif ($download_type eq 'TrialLayout') {

function show_fieldbook_treatments_<% $download_type %>(){
    jQuery('#create_fieldbook_treatment_<% $download_type %>').html('Include All Management Factors In Download');
    jQuery('#create_fieldbook_format_div_<% $download_type %>').show();
}

function open_create_fieldbook_dialog_<% $download_type %>() {
    var trial_id = parseInt(jQuery('#html_select_trial_for_create_fieldbook_<% $download_type %>').val());
    var data_level = jQuery('#create_fieldbook_data_level_<% $download_type %>').val();
    var selected_columns = JSON.stringify(selected_columns_<% $download_type %>);
    var trait_list_id = jQuery('#create_fieldbook_with_trait_list_select_<% $download_type %>_list_select').val();
    var format = jQuery('#create_fieldbook_format_<% $download_type %>').val();
    console.log(format); 
    //Calls SGN::Controller:BreedersToolbox::Trial
    window.open("/breeders/trial/"+trial_id+"/download/layout?format="+format+"&dataLevel="+data_level+"&selected_columns="+selected_columns+"&trait_list_id="+trait_list_id);
}

% } elsif ($download_type eq 'TrialFieldMapLayout') {

function show_fieldbook_treatments_<% $download_type %>(){
    jQuery('#create_fieldbook_format_div_<% $download_type %>').show();
}

function open_create_fieldbook_dialog_<% $download_type %>() {
    var trial_id = parseInt(jQuery('#html_select_trial_for_create_fieldbook_<% $download_type %>').val());
    var data_level = 'plot_fieldMap';
    var selected_columns_TrialFieldMapLayout = {'row_number':1,'col_number':1,'accession_name':1};
    var selected_columns = JSON.stringify(selected_columns_TrialFieldMapLayout);
    var format = jQuery('#create_fieldbook_format_<% $download_type %>').val();
    window.open("/breeders/trial/"+trial_id+"/download/layout?format="+format+"&dataLevel="+data_level+"&selected_columns="+selected_columns);
}

% }


</script>
