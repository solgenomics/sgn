<%args>
    $feature
    $blast_url => undef
    $children  => undef
    $parents   => undef
</%args>

<%init>
    use Bio::Seq;
    use Data::Dumper;
</%init>

<& /page/page_title.mas, title => 'Feature Viewer: '. $feature->id &>

<& /util/import_javascript.mas,
    classes => [qw(Text.Markup CXGN.Effects CXGN.Phenome.Locus MochiKit.DOM) ]
&>
<%perl>
    my $seq = Bio::PrimarySeq->new(
        -seq => $feature->residues,
        -alphabet => 'dna',
    );
    my $organism = $feature->organism;
    my $species  = $organism->species;
    $species    =~ s!(\S+) !<i>$1</i> !;
    my $dbxref = $feature->dbxref;

    #my @cvs = $feature->feature_cvterms;
    #die Dumper [ @cvs ];
</%perl>

<&| /page/info_section.mas,
    title => 'Feature Data',
&>
Feature Type: <% $feature->type->name %><br/>
Analysis: <% $feature->is_analysis ? 'Yes' : 'No' %><br/>
Obsolete: <% $feature->is_obsolete ? 'Yes' : 'No' %><br/>
Accession Time: <% $feature->timeaccessioned %><br/>
<% defined $dbxref ?  '<a href="' . $dbxref->db->urlprefix .  $dbxref->db->url .  $dbxref->dbxref_id . '">dbxref</a>' : '' %>
</a><br/>
% my $c = 0;
% for my $child (@$children) {
% # This should be ->feature, but that returns itself => bug in BCS
% my $f = $child->srcfeature;
Child Feature:
    <&| /feature/link.mas, feature => $f, &> </&>
is a <% $f->type->name %><br>
% last if ++$c > 10;
% }
% $c = 0;
% for my $parent (@$parents) {
% my $f = $parent->feature;
Parent Feature:
    <&| /feature/link.mas, feature => $f, &> </&>
    is a <% $f->type->name %><br>

% last if ++$c > 10;
% }

</&>

<&| /page/info_section.mas,
    title       => 'Organism',
    collapsible => 1,
    collapsed   => 1,
&>
   <% $species%> (<%ucfirst($organism->common_name) %>)<p/>
   Comment: <% $organism->comment %>
</&>


<&| /page/info_section.mas,
        title       => 'Nucleotide Sequence',
        collapsible => 1,
        collapsed   => 0,
&>
  Length : <% $seq->length %><br/>
  <% $feature->md5checksum ?  'MD5 :' . $feature->md5checksum : '' %>
  <p/>
% if( $seq->length > 30_000) {
    <a href="/cgi-bin/feature_sequence_as_fasta.pl?feature_id=<% $feature->feature_id %>">Download as FASTA</a>
% } else {
  <div style="margin-left: 3em">
    <& /sequence/with_markup.mas,
        seq       => $seq,
        width     => 80,
        subdiv    => undef,
        blast_url => $blast_url
    &>
  </div>
% }
</&>
