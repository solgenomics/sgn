<%doc>

=head1 NAME

/phenome/associate_locus.mas - a component for printing a generic 'associate_locus' javasript form

=head1 DESCRIPTION

this component has dependencies on CXGN.Phenome.Locus and CXGN.Phenome.Tools
you will have to import these javascript classes in your code that uses this component.

<& /util/import_javascript.mas, classes => ["CXGN.Phenome.Locus", "CXGN.Phenome.Tools"] &>


Parameters:

=over 1

=item locus_id

a database id



=back

=head1 AUTHOR

Naama Menda <nm249@cornell.edu>

=cut


</%doc>

<%args>

$object_id
$type
$locus_autocomplete_uri => ''
$locus_add_uri
$show_form => 0
$allele_div

</%args>

<& /util/import_javascript.mas, classes=>[qw[ jquery jqueryui popup]] &>

<div id = "<% $allele_div %>" >&nbsp;Loading..</div>

<script language="javascript">
  display_alleles("<% $allele_div %>");

  jQuery(function() {
     jQuery("#loci").autocomplete({
	 source: '<% $locus_autocomplete_uri %>'
     });
  });

  function submit_locus_form() {
    //make an AJAX request with the form params
    var loci = jQuery("#loci").val();
    jQuery.ajax({ url: "<% $locus_add_uri %>" , method:"POST", data: 'object_id='+<% $object_id %>+'&loci='+loci ,
     success: function() {
      display_alleles( "<% $allele_div %>" );
     }
   } );
  }

  function display_alleles(allele_div) {
  jQuery.ajax( { url: "/stock/"+<% $object_id %>+"/alleles" , dataType: "json",
      success: function(response) {
       var json = response;
       jQuery("#"+allele_div).html(response.html);
      }
  } );
}

</script>

<div id = "<%$allele_div %> >

</div>

<div id="associate_locus_form">
  <b>Associate another Locus</b>
  <div id="locus_search" >
    <form name="loci_form" >
      <input type="text" style="width: 50%" id="loci" name="loci" />
      <input type="hidden" id="object_id" name="object_id" value="<% $object_id %>" />

      <input type="button" name = "associate_locus" onclick="javascript:submit_locus_form()" value = "Associate locus" />
      <div style="font-size: 80%; margin-left: 1em; color: #333">type a locus name</div>
    </form>
  </div>
</div>


